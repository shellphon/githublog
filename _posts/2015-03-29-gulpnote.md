---
layout: post
title: gulp学习笔记
category: Hello Code
---

刚记录了下`grunt`,少不了`gulp`。

* #### **首先**，安装 
> npm install -g gulp //全局安装gulp

* #### **然后**还要在项目目录下安装gulp（其实还不是很理解这样做的原理，再看看先）
> npm install gulp --save-dev

* #### **然后**项目目录下写`gulpfile.js`(同样名字不能改)
{%highlight javascript linenos%}
var gulp = require('gulp');
gulp.task('default',function(){});
{%endhighlight%}

这样之后在目录下执行：

> gulp

* #### **当然**可以定义其他`task`（taskA），执行时，
> gulp taskA

代码：
{%highlight javascript linenos%}
gulp.task('taskA',function(){
    gulp.src('js/app.js')
        .pipe(uglify())
        .pipe(gulp.dest('build'));
});
{%endhighlight%}

> taskA: 将app.js进行`uglify`操作，然后输出到`build`目录下，生成同名文件

`uglify`需要安装：
   
> npm install gulp-uglify --save-dev

{%highlight javascript linenos%}
//gulpfile.js实例
var gulp = require('gulp'),
 uglify = require('gulp-uglify'),
 minCss = require('gulp-minify-css'),
 concat = require('gulp-concat'),
 clean = require('gulp-clean'),
 replace = require('gulp-replace');

var vers = require('./vers.json'); 
console.log(vers);

gulp.task('clean',function(){//清空内容
 return gulp.src('dist/').pipe(clean());
});

gulp.task('js', ['clean'], function(){//压缩js
 return gulp.src('../src/js/**/*.js')
   .pipe(uglify())
   .pipe(gulp.dest('dist/js'));
});

gulp.task('css', ['clean'],function(){//压缩css
 return gulp.src(['../src/css/**/*.css',
  '!../src/css/*old.css',
  '!../src/css/reset.css',
  '!../src/css/btns.css',
  '!../src/css/global.css',
  '!../src/css/form.css',
  '!../src/css/layout.css'])
  .pipe(replace(/@IMAGE_VERSION@/g, vers.v))//替换版本号
  .pipe(minCss())
  .pipe(gulp.dest('dist/css/'));
});

gulp.task('globalcss', ['clean'], function(){//压缩合并css
 return gulp.src(['../src/css/reset.css',
  '../src/css/btns.css',
  '../src/css/global.css',
  '../src/css/form.css',
  '../src/css/layout.css'])
  .pipe(concat('global.css'))//先合并再做minify
  .pipe(minCss())
  .pipe(gulp.dest('dist/css/'));
});

gulp.task('default', ['clean','css','globalcss','js'],function(){
 var fs = require('fs');
 console.log('I am gulp.');
 console.log('当前使用版本号：'+vers.v);
 fs.writeFile('vers.json', '{"v":'+(vers.v+1)+'}');//结束时自增版本号
});
{%endhighlight%}

对比`grunt`，代码量看起来差不多，但相比之下，可读性比较好，可观。
